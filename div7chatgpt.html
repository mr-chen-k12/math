<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Decimal Division Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  :root {
    color-scheme: light;
    --blue: #1976d2;
    --green: #2e7d32;
    --red: #d32f2f;
    --gray: #546e7a;
    --bg: #f5f7fb;
  }

  body {
    margin: 0;
    padding: 16px;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: var(--bg);
    display: flex;
    justify-content: center;
  }

  .shell {
    width: 100%;
    max-width: 720px;
    background: #ffffff;
    border-radius: 14px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    padding: 18px 16px 24px;
  }

  h1 {
    text-align: center;
    margin: 4px 0 10px;
    font-size: 1.6rem;
  }

  .top-buttons {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 10px;
    flex-wrap: wrap;
  }

  button {
    border-radius: 999px;
    border: none;
    padding: 8px 16px;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    color: #fff;
    transition: transform 0.05s ease, box-shadow 0.05s ease, opacity 0.15s;
  }

  button:active {
    transform: translateY(1px);
    box-shadow: none;
  }

  .btn-primary {
    background: var(--blue);
    box-shadow: 0 2px 6px rgba(25,118,210,0.4);
  }

  .btn-secondary {
    background: var(--gray);
    box-shadow: 0 2px 6px rgba(84,110,122,0.4);
  }

  .btn-check {
    background: var(--green);
    box-shadow: 0 2px 6px rgba(46,125,50,0.35);
    width: 100%;
    max-width: 260px;
  }

  .problem-card {
    margin: 10px auto 12px;
    padding: 16px;
    border-radius: 12px;
    background: #eef2ff;
    border: 2px solid #c5cae9;
    text-align: center;
  }

  .problem-text {
    font-size: 1.8rem;
    font-weight: 600;
  }

  .helper-card {
    display: none;
    margin: 0 auto 16px;
    padding: 12px 14px;
    border-radius: 10px;
    background: #fff8e1;
    border: 1px solid #ffe082;
    font-size: 0.95rem;
    line-height: 1.4;
  }

  .helper-highlight {
    color: var(--red);
    font-weight: 700;
  }

  .answer-row {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
    flex-wrap: wrap;
  }

  .answer-row label {
    font-size: 1rem;
  }

  .answer-input {
    font-size: 1.2rem;
    padding: 4px 6px;
    min-width: 90px;
    text-align: center;
    border-radius: 8px;
    border: 2px solid #b0bec5;
  }

  .feedback {
    text-align: center;
    min-height: 1.4em;
    margin-bottom: 10px;
    font-weight: 600;
  }

  .feedback.correct {
    color: var(--green);
  }

  .feedback.incorrect {
    color: var(--red);
  }

  .center-row {
    display: flex;
    justify-content: center;
  }

  /* Long division area */

  .work-card {
    margin-top: 18px;
    padding: 14px 12px 10px;
    border-radius: 10px;
    border: 1px solid #cfd8dc;
    background: #fafafa;
  }

  .work-title {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 6px;
  }

  .ld-intro {
    font-size: 0.95rem;
    margin-bottom: 10px;
  }

  .ld-box {
    font-family: "Courier New", Consolas, monospace;
    font-size: 1rem;
    line-height: 1.1;
  }

  .ld-line {
    border-top: 2px solid #000;
    margin-top: 2px;
    margin-bottom: 2px;
  }

  .ld-top-row {
    display: flex;
    justify-content: flex-end;
    padding-right: 18px;
    margin-bottom: 2px;
  }

  .ld-quotient {
    letter-spacing: 0.3ch;
  }

  .ld-main-row {
    display: flex;
    align-items: stretch;
  }

  .ld-divisor {
    padding-right: 4px;
    display: flex;
    align-items: center;
  }

  .ld-main-dividend {
    border-top: 2px solid #000;
    border-left: 2px solid #000;
    padding: 2px 4px 4px 6px;
    flex: 1;
  }

  .ld-digits {
    letter-spacing: 0.3ch;
    white-space: pre;
  }

  .ld-steps {
    margin-top: 6px;
  }

  .ld-step-block {
    margin-top: 4px;
  }

  .ld-current,
  .ld-product,
  .ld-remainder {
    white-space: pre;
  }

  .ld-product span {
    color: var(--red);
  }

  .ld-remainder span {
    color: var(--blue);
  }

  .ld-dash {
    border-bottom: 1px solid #444;
    height: 1px;
    margin-top: 1px;
    margin-bottom: 1px;
  }

  .small-note {
    font-size: 0.8rem;
    color: #78909c;
    margin-top: 6px;
  }

  @media (max-width: 480px) {
    .problem-text {
      font-size: 1.6rem;
    }
    .answer-input {
      min-width: 74px;
    }
  }
</style>
</head>
<body>
<div class="shell">
  <h1>Decimal Division Studio</h1>

  <div class="top-buttons">
    <button class="btn-primary" onclick="newProblem()">New Problem</button>
    <button class="btn-secondary" onclick="toggleHelper()">Toggle Helper</button>
  </div>

  <div class="problem-card">
    <div id="problemText" class="problem-text">0 Ã· 0 = ?</div>
  </div>

  <div id="helperCard" class="helper-card">
    <div><strong>Step 1:</strong> Move the decimal point 
      <span id="helperPlaces" class="helper-highlight">0</span> place(s) to the right
      on both numbers so the divisor is a whole number.</div>
    <div id="helperExample" style="margin-top:4px;"></div>
  </div>

  <div class="answer-row">
    <label for="answerInput">Your answer:</label>
    <input id="answerInput" class="answer-input" type="text" autocomplete="off" />
  </div>

  <div class="center-row">
    <button class="btn-check" onclick="checkAnswer()">Check Answer</button>
  </div>

  <div id="feedback" class="feedback"></div>

  <div id="workCard" class="work-card" style="display:none;">
    <div class="work-title">Long Division Work</div>
    <div id="ldIntro" class="ld-intro"></div>
    <div id="ldBox" class="ld-box"></div>
    <div class="small-note">Red = what we subtract, Blue = what is left (remainder).</div>
  </div>
</div>

<script>
/* ---------- Problem generation ---------- */

let current = {
  dividend: 4.45,
  divisor: 0.4,
  quotient: 11.125,
  places: 1,
  scaledDividend: 445,
  scaledDivisor: 40,
  longSteps: []
};

function randomInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

// Make a "nice" decimal-division problem for 6th grade
function makeProblem() {
  // base integers
  const baseDivisor = randomInt(2, 9);
  const baseQuotient = randomInt(2, 30);

  // choose decimal places for divisor (0 or 1)
  const divisorDecimals = Math.random() < 0.6 ? 1 : 0;
  const dividendDecimals = randomInt(1, 2);

  const divScale = Math.pow(10, divisorDecimals);
  const quotScale = Math.pow(10, dividendDecimals);

  // make an exact integer division, then scale
  const integerDividend = baseDivisor * baseQuotient;
  const dividend = (integerDividend / quotScale).toFixed(dividendDecimals);
  const divisor = (baseDivisor / divScale).toFixed(divisorDecimals);

  const places = Math.max(divisorDecimals, 0); // how many places to move to make divisor whole

  const scale = Math.pow(10, places);
  const scaledDividend = Math.round(parseFloat(dividend) * scale);
  const scaledDivisor = Math.round(parseFloat(divisor) * scale);

  const quotient = parseFloat(dividend) / parseFloat(divisor);

  // long-division steps on scaled integers
  const longSteps = longDivisionSteps(scaledDividend, scaledDivisor);

  return {
    dividend: parseFloat(dividend),
    divisor: parseFloat(divisor),
    quotient: quotient,
    places: places,
    scaledDividend,
    scaledDivisor,
    longSteps
  };
}

/* ---------- Long division engine (integers) ---------- */

function longDivisionSteps(N, D) {
  const digits = String(N).split("").map(d => parseInt(d, 10));
  let current = 0;
  let steps = [];
  let quotientDigits = [];

  for (let i = 0; i < digits.length; i++) {
    current = current * 10 + digits[i];

    if (current < D) {
      quotientDigits.push(0);
      steps.push({
        index: i,
        used: false,
        currentBefore: current,
        q: 0,
        product: 0,
        remainder: current
      });
      continue;
    }

    const q = Math.floor(current / D);
    const product = q * D;
    const remainder = current - product;

    quotientDigits.push(q);
    steps.push({
      index: i,
      used: true,
      currentBefore: current,
      q,
      product,
      remainder
    });

    current = remainder;
  }

  return { steps, quotientDigits };
}

/* ---------- Rendering helpers ---------- */

function showProblemOnScreen() {
  const divStr = current.dividend.toString();
  const dvrStr = current.divisor.toString();

  document.getElementById("problemText").textContent =
    `${divStr} Ã· ${dvrStr} = ?`;

  // helper text
  const places = current.places;
  const helperCard = document.getElementById("helperCard");
  const helperPlaces = document.getElementById("helperPlaces");
  const helperExample = document.getElementById("helperExample");

  helperPlaces.textContent = places;
  const before = `${current.dividend} Ã· ${current.divisor}`;
  const after = `${current.scaledDividend} Ã· ${current.scaledDivisor}`;
  helperExample.textContent = `Example:  ${before}  â†’  ${after}`;
}

/* Build long-division HTML block */
function buildLongDivisionHTML() {
  const scaledDividendStr = String(current.scaledDividend);
  const scaledDivisorStr = String(current.scaledDivisor);
  const quotientVal = current.scaledDividend / current.scaledDivisor;
  const quotientStr = quotientVal.toString(); // integer or decimal

  const digits = scaledDividendStr.split("");
  const totalDigits = digits.length;

  const { steps, quotientDigits } = current.longSteps;
  // Convert quotient digits to string (no decimals, just integer long division)
  let qDigitsStr = quotientDigits.join("");
  // Remove leading zeros
  qDigitsStr = qDigitsStr.replace(/^0+/, "") || "0";

  // --- Build main layout ---
  let html = "";

  // Top row: quotient
  html += `<div class="ld-top-row"><span class="ld-quotient">${qDigitsStr.split("").join(" ")}</span></div>`;

  // Main row: divisor ) dividend
  html += `<div class="ld-main-row">
    <div class="ld-divisor">${scaledDivisorStr}</div>
    <div class="ld-main-dividend">
      <div class="ld-digits">${scaledDividendStr.split("").join(" ")}</div>
    </div>
  </div>`;

  // Steps: show under the dividend area with indentation
  html += `<div class="ld-steps">`;

  const baseIndent = 1; // starting indent in "ch"

  steps.forEach((s, i) => {
    const indent = baseIndent + i; // move slightly right each step

    // First line: current amount being divided
    html += `<div class="ld-step-block">
      <div class="ld-current" style="margin-left:${indent}ch;">
        <span>${s.currentBefore}</span>
      </div>`;

    // Second line: product (in red)
    if (s.used && s.q !== 0) {
      html += `<div class="ld-product" style="margin-left:${indent}ch;">
        <span>${s.product}</span>
      </div>
      <div class="ld-dash" style="margin-left:${indent}ch;"></div>`;
    } else {
      html += `<div class="ld-product" style="margin-left:${indent}ch;">
        <span>0</span>
      </div>
      <div class="ld-dash" style="margin-left:${indent}ch;"></div>`;
    }

    // Third line: remainder (in blue)
    html += `<div class="ld-remainder" style="margin-left:${indent + 1}ch;">
      <span>${s.remainder}</span>
    </div>
    </div>`;
  });

  html += `</div>`;

  return html;
}

/* ---------- UI actions ---------- */

function newProblem() {
  current = makeProblem();
  showProblemOnScreen();
  document.getElementById("answerInput").value = "";
  document.getElementById("feedback").textContent = "";
  document.getElementById("feedback").className = "feedback";
  document.getElementById("workCard").style.display = "none";
}

function toggleHelper() {
  const card = document.getElementById("helperCard");
  card.style.display = (card.style.display === "none" || card.style.display === "") ?
                       "block" : "none";
}

function checkAnswer() {
  const input = document.getElementById("answerInput").value.trim();
  const fb = document.getElementById("feedback");

  if (input === "") {
    fb.textContent = "Type your answer first.";
    fb.className = "feedback incorrect";
    return;
  }

  const student = parseFloat(input);
  const correct = current.quotient;
  const isClose = Math.abs(student - correct) < 0.01;

  if (isClose) {
    fb.textContent = "Nice job! Thatâ€™s correct. ðŸŽ‰";
    fb.className = "feedback correct";
  } else {
    fb.textContent = `Not quite. The exact answer is ${correct.toFixed(3)}.`;
    fb.className = "feedback incorrect";
  }

  // Always show the long-division steps after checking
  const intro = document.getElementById("ldIntro");
  const places = current.places;

  if (places > 0) {
    intro.textContent =
      `We first move the decimal point ${places} place(s) to the right `
      + `in both numbers:  ${current.dividend} Ã· ${current.divisor} `
      + `becomes  ${current.scaledDividend} Ã· ${current.scaledDivisor}. `
      + `Then we divide using long division:`;
  } else {
    intro.textContent =
      `Both numbers already make a whole-number divisor, so we divide directly `
      + `using long division:`;
  }

  document.getElementById("ldBox").innerHTML = buildLongDivisionHTML();
  document.getElementById("workCard").style.display = "block";
}

/* ---------- Start with a problem ---------- */
newProblem();
</script>
</body>
</html>