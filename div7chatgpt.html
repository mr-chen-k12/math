<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Decimal Division Studio – Kid Friendly</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    body {
        font-family: "Comic Sans MS", "Segoe UI", sans-serif;
        background: #fafafa;
        margin: 0;
        padding: 20px;
        text-align: center;
    }

    h1 { margin-top: 10px; }

    #problemBox {
        font-size: 2rem;
        background: #eef;
        padding: 15px;
        border-radius: 10px;
        margin-top: 20px;
    }

    .btn {
        padding: 10px 20px;
        border: none;
        color: white;
        border-radius: 8px;
        margin: 8px;
        font-size: 1rem;
    }
    .blue { background: #3b82f6; }
    .gray { background: #6b7280; }
    .green { background: #10b981; }

    #stepBox {
        max-width: 420px;
        margin: 20px auto;
        background: #fff8dc;
        padding: 15px;
        border-radius: 10px;
        font-size: 1.1rem;
        display: none;
    }

    /* Long division visual */
    #work {
        margin-top: 25px;
        font-size: 1.4rem;
        text-align: left;
        display: inline-block;
        line-height: 1.6;
        white-space: pre;
        font-family: monospace;
    }

    .hiddenStep {
        opacity: 0.15;
        transition: 0.2s;
    }

    .visibleStep {
        opacity: 1;
    }
</style>
</head>
<body>

<h1>Decimal Division Studio</h1>

<button class="btn blue" onclick="newProblem()">New Problem</button>
<button class="btn gray" onclick="toggleHelper()">Toggle Helper</button>
<button class="btn green" onclick="revealNext()">Reveal Next Step</button>

<div id="problemBox"></div>

<div id="stepBox"></div>

<div id="work"></div>

<script>
let dividend, divisor, quotient;
let currentStep = 0;
let steps = [];

function newProblem() {
    // Generate clean decimal problem like 4.45 ÷ 0.4
    let a = (Math.random() * 9 + 1).toFixed(2);
    let b = (Math.random() * 0.9 + 0.1).toFixed(1);

    dividend = a;
    divisor = b;
    quotient = (a / b).toFixed(3);

    document.getElementById("problemBox").innerHTML = `${a} ÷ ${b} = ?`;

    buildSteps();
    renderSteps();
}

function toggleHelper() {
    let box = document.getElementById("stepBox");
    box.style.display = (box.style.display === "none") ? "block" : "none";
}

function buildSteps() {
    currentStep = 0;
    steps = [];

    // Determine how many decimal places to move
    let move = divisor.split(".")[1].length;

    let scaledDividend = (parseFloat(dividend) * Math.pow(10, move)).toFixed(0);
    let scaledDivisor = (parseFloat(divisor) * Math.pow(10, move)).toFixed(0);

    // Step 1: Move the decimal
    steps.push({
        text: `Step 1: Move the decimal ${move} place to the right on both numbers.\n`
            + `(${dividend} ÷ ${divisor} → ${scaledDividend} ÷ ${scaledDivisor})`
    });

    // Build long division numeric steps manually
    let d = parseInt(scaledDividend);
    let v = parseInt(scaledDivisor);

    let temp = d;
    let q = "";
    let longSteps = [];

    let digits = String(d).split("");

    let remainder = 0;
    let bringDownStr = "";

    let partial = "";

    // Do classic long division step by step
    for (let i = 0; i < digits.length; i++) {
        remainder = remainder * 10 + parseInt(digits[i]);

        if (remainder < v) {
            q += "0";
            longSteps.push({
                text: `Bring down ${digits[i]} → still less than ${v}, write 0 on top.`,
            });
            continue;
        }

        let stepQ = Math.floor(remainder / v);
        let prod = stepQ * v;
        let newRem = remainder - prod;

        q += stepQ;

        longSteps.push({
            text:
                `Divide: ${remainder} ÷ ${v} = ${stepQ}\n` +
                `Multiply: ${stepQ} × ${v} = ${prod}\n` +
                `Subtract: ${remainder} − ${prod} = ${newRem}`
        });

        remainder = newRem;
    }

    // Add all numeric steps
    longSteps.forEach(s => steps.push(s));

    // Final answer
    steps.push({
        text: `Final Answer: ${dividend} ÷ ${divisor} = ${quotient}`
    });
}

function renderSteps() {
    let work = document.getElementById("work");
    let helper = document.getElementById("stepBox");

    work.innerHTML = "";
    helper.innerHTML = "";

    // Long division top layout (static)
    work.innerHTML += 
`   ${String(quotient).padEnd(8)} 
${divisor})${String(dividend).padEnd(4)}\n\n`;

    // Render hidden steps
    steps.forEach((s, i) => {
        work.innerHTML += `<div id="step${i}" class="hiddenStep">${s.text}</div>\n`;
    });
}

function revealNext() {
    if (currentStep < steps.length) {
        document.getElementById("step" + currentStep).classList.remove("hiddenStep");
        document.getElementById("step" + currentStep).classList.add("visibleStep");
        document.getElementById("stepBox").innerHTML = steps[currentStep].text;
        currentStep++;
    }
}

// Initialize
newProblem();
</script>

</body>
</html>