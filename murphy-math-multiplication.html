<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Murphy Math — Multiplication Game</title>
  <meta name="description" content="Practice multiplication facts by table or mix & match. Timer mode, streaks, and local leaderboard.">
  <style>
    :root{
      --murphy-green:#0B7A4B;
      --murphy-dark:#084B33;
      --murphy-light:#E8F5EF;
      --murphy-gold:#F2C14E;
      --ink:#16302B;
      --bg:#ffffff;
      --muted:#78948D;
      --error:#D64545;
      --ok:#1B9C68;
      --card:#ffffff;
      --shadow: 0 10px 25px rgba(0,0,0,.08), 0 2px 6px rgba(0,0,0,.06);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji", "Segoe UI Symbol";
      color:var(--ink);
      background:
        radial-gradient(1200px 600px at -10% -10%, var(--murphy-light), transparent 60%),
        radial-gradient(1000px 500px at 110% -20%, #f7f7f7, transparent 60%),
        radial-gradient(800px 400px at 120% 120%, var(--murphy-light), transparent 60%),
        var(--bg);
    }
    header{
      position:sticky; top:0; z-index:10;
      background:linear-gradient(90deg, var(--murphy-dark), var(--murphy-green));
      color:#fff;
      padding:16px 20px;
      box-shadow: var(--shadow);
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      font-weight:800; letter-spacing:.3px;
    }
    .brand-logo{
      width:40px; height:40px; border-radius:12px;
      background: conic-gradient(from 180deg at 50% 50%, var(--murphy-gold), #fff 20%, var(--murphy-green) 60%, var(--murphy-dark) 100%);
      display:grid; place-items:center;
      box-shadow: inset 0 4px 10px rgba(0,0,0,.15);
    }
    .brand span{font-size:18px}
    main{
      max-width:1100px; margin:24px auto; padding:0 16px 60px;
      display:grid; grid-template-columns: 320px 1fr; gap:18px;
    }
    @media (max-width: 980px){
      main{grid-template-columns: 1fr}
    }
    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
    }
    .panel-title{font-weight:700; color:var(--murphy-dark); margin:4px 0 12px}
    .chips{ display:flex; flex-wrap:wrap; gap:10px }
    .chip{
      border:1.5px solid var(--murphy-green); color:var(--murphy-dark);
      background:#fff; padding:8px 12px; border-radius:999px; cursor:pointer;
      user-select:none; transition:.15s transform, .15s background;
      font-weight:600; font-size:14px;
    }
    .chip:hover{ transform: translateY(-1px) }
    .chip.active{ background:var(--murphy-green); color:#fff }
    .controls{ display:grid; gap:14px }
    .row{ display:flex; align-items:center; gap:10px; flex-wrap:wrap }
    .row label{ font-weight:600; color:var(--ink) }
    .btn{
      background:var(--murphy-green); color:#fff; border:none; border-radius:12px;
      padding:10px 14px; font-weight:700; cursor:pointer; box-shadow: var(--shadow);
      transition: .15s transform, .15s filter;
    }
    .btn:hover{ transform: translateY(-1px) }
    .btn.secondary{ background:#fff; color:var(--murphy-dark); border:1.5px solid var(--murphy-green) }
    .btn.ghost{ background:transparent; color:var(--murphy-dark); border:1.5px solid #d9e5e1 }
    .btn.warn{ background:var(--error) }
    .tiny{ font-size:12px; color:var(--muted) }
    .divider{ height:1px; background:#e9efec; margin:8px 0 }
    .statbar{
      display:flex; gap:12px; flex-wrap:wrap; padding:10px 12px; border-radius:12px;
      background: linear-gradient(180deg, #f7fbf9, #eef6f2);
      border:1px solid #e1eee8;
    }
    .stat{ display:grid; gap:4px }
    .stat .k{ font-size:12px; color:var(--muted) }
    .stat .v{ font-weight:800; color:var(--murphy-dark) }
    .game{
      display:grid; gap:14px; place-items: center;
      text-align:center; padding:10px;
    }
    .problem{
      font-size: clamp(38px, 6vw, 64px);
      font-weight:900; color:var(--murphy-dark);
      letter-spacing: .5px;
    }
    .answer{
      display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap;
    }
    input[type="number"]{
      font-size:22px; padding:10px 12px; border-radius:12px; border:1.5px solid #cfe4dc; width:140px;
      outline:none;
    }
    .feedback{
      min-height:24px; font-weight:700; color:var(--muted);
    }
    .feedback.ok{ color:var(--ok) }
    .feedback.err{ color:var(--error) }
    .pill{
      background:#fff; border:1.5px solid #e2eee8; border-radius:12px; padding:6px 10px; color:var(--murphy-dark); font-weight:700;
    }
    .flex{ display:flex; align-items:center; gap:10px; flex-wrap:wrap }
    .space{ flex:1 }
    .toggle{
      display:inline-grid; grid-auto-flow:column; gap:6px; align-items:center; cursor:pointer; font-weight:700;
    }
    .toggle input{ appearance:none; width:40px; height:22px; border-radius:999px; background:#ddd; position:relative; outline:none; transition:.15s background }
    .toggle input:checked{ background:var(--murphy-green) }
    .toggle input:before{
      content:""; position:absolute; top:3px; left:3px; width:16px; height:16px; border-radius:50%; background:#fff; transition:.15s left;
      box-shadow:0 1px 3px rgba(0,0,0,.35);
    }
    .toggle input:checked:before{ left:21px }
    .kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; background:#f0f5f2; padding:2px 6px; border-radius:6px; border:1px solid #dfeae6 }
    .leaderboard{ width:100%; border-collapse: collapse; }
    .leaderboard th, .leaderboard td{ padding:10px; border-bottom:1px dashed #e3ece8; text-align:left }
    .leaderboard tr:hover{ background:#f7fbf9 }
    .footer-note{ text-align:center; color:var(--muted); margin-top:6px; font-size:12px }
    /* Confetti */
    .confetti{ position:fixed; inset:0; pointer-events:none; overflow:hidden }
    .confetti i{
      position:absolute; width:10px; height:16px; opacity:0; animation: fall 1200ms ease-out forwards;
      transform: translateY(-20px) rotate(0deg);
    }
    @keyframes fall{
      0% { opacity:0; transform: translateY(-20px) rotate(0deg) }
      10% { opacity:1 }
      100% { opacity:0; transform: translateY(100vh) rotate(340deg) }
    }
  </style>
</head>
<body>
  <header>
    <div class="brand" aria-label="Murphy Math">
      <div class="brand-logo" aria-hidden="true"></div>
      <span>Murphy Math — Multiplication</span>
    </div>
  </header>

  <main>
    <!-- Left: settings -->
    <section class="card" aria-labelledby="settings-title">
      <h2 id="settings-title" class="panel-title">Choose Tables</h2>
      <div class="chips" id="tableChips" role="group" aria-label="Times tables">
        <!-- JS inserts chips 1..12 -->
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn secondary" id="btnAll">Select All</button>
        <button class="btn ghost" id="btnClear">Clear</button>
        <span class="tiny">Tip: Pick one for focused practice or several for a mixed challenge.</span>
      </div>

      <div class="divider"></div>

      <div class="controls">
        <div class="row">
          <label for="maxMultiplier">Max multiplier:</label>
          <input id="maxMultiplier" type="range" min="5" max="12" value="12" />
          <span class="pill"><span id="maxVal">12</span> ×</span>
        </div>

        <div class="row">
          <label>Mode:</label>
          <button class="btn" id="modePractice">Practice</button>
          <button class="btn secondary" id="modeArcade">Arcade :60</button>
          <span class="tiny">Practice = no timer. Arcade = 60 seconds, score as much as you can.</span>
        </div>

        <div class="row">
          <label class="toggle" title="Sound effects">
            <input type="checkbox" id="sfxToggle" />
            <span>SFX</span>
          </label>
          <label class="toggle" title="Big key hints for keyboard users">
            <input type="checkbox" id="hintsToggle" checked />
            <span>Hints</span>
          </label>
          <div class="space"></div>
          <button class="btn ghost" id="btnResetStats">Reset Stats</button>
        </div>
      </div>
    </section>

    <!-- Right: game -->
    <section class="card">
      <div class="statbar" role="status">
        <div class="stat"><div class="k">Mode</div><div class="v" id="statMode">Practice</div></div>
        <div class="stat"><div class="k">Timer</div><div class="v" id="statTimer">∞</div></div>
        <div class="stat"><div class="k">Score</div><div class="v" id="statScore">0</div></div>
        <div class="stat"><div class="k">Streak</div><div class="v" id="statStreak">0</div></div>
        <div class="stat"><div class="k">Best</div><div class="v" id="statBest">0</div></div>
        <div class="stat"><div class="k">Accuracy</div><div class="v" id="statAcc">100%</div></div>
      </div>

      <div class="game">
        <div class="problem" id="problem" aria-live="polite">3 × 4 = ?</div>
        <div class="answer">
          <input id="answer" type="number" inputmode="numeric" autocomplete="off" placeholder="Type answer" aria-label="Your answer" />
          <button class="btn" id="btnSubmit"><span id="submitLabel">Submit</span> <span class="tiny" id="hintEnter">(or press <span class="kbd">Enter</span>)</span></button>
          <button class="btn secondary" id="btnSkip" title="Skip this question">Skip</button>
        </div>
        <div class="feedback" id="feedback" aria-live="polite"></div>
      </div>

      <div class="divider"></div>

      <div class="card" style="background:#f8fbf9;border:1px solid #e1eee8">
        <h3 class="panel-title">Local Leaderboard (Arcade)</h3>
        <table class="leaderboard" id="board">
          <thead><tr><th>#</th><th>Score</th><th>Accuracy</th><th>Date</th></tr></thead>
          <tbody></tbody>
        </table>
        <div class="footer-note">Scores are saved on this device only (localStorage).</div>
      </div>
    </section>
  </main>

  <div class="confetti" id="confetti" aria-hidden="true"></div>

  <script>
    // --- Utilities ---
    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));
    const rand = (n) => Math.floor(Math.random()*n);
    const choice = (arr) => arr[rand(arr.length)];
    const clamp = (n,min,max)=>Math.max(min,Math.min(max,n));

    // Simple sound generator (no external files)
    function beep(type="ok"){
      if(!$('#sfxToggle').checked) return;
      const ctx = new (window.AudioContext||window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.connect(g); g.connect(ctx.destination);
      o.type = type==="ok" ? "triangle" : "sawtooth";
      o.frequency.value = type==="ok" ? 620 : 140;
      g.gain.value = .0001;
      o.start();
      const now = ctx.currentTime;
      g.gain.exponentialRampToValueAtTime(.2, now+.02);
      g.gain.exponentialRampToValueAtTime(.0001, now+.18);
      o.stop(now+.2);
    }

    // Confetti
    function celebrate(){
      const root = $('#confetti');
      for(let i=0;i<40;i++){
        const piece = document.createElement('i');
        const hue = 120 + Math.floor(Math.random()*60); // greenish
        piece.style.left = Math.random()*100 + 'vw';
        piece.style.top = '-10vh';
        piece.style.background = `hsl(${hue}deg 70% 50%)`;
        piece.style.transform = `translateY(0) rotate(${Math.random()*180}deg)`;
        piece.style.animationDelay = (i*8)+'ms';
        root.appendChild(piece);
        setTimeout(()=> piece.remove(), 1600);
      }
    }

    // --- State ---
    const state = {
      tables: new Set([1,2,3,4,5]),
      maxMul: 12,
      mode: 'practice', // 'arcade'
      a: 3, b: 4, answer: 12,
      score: 0, correct: 0, attempts: 0, streak: 0, best: 0,
      timer: null, timeLeft: Infinity,
      history: [],
    };

    // Local storage helpers
    const LS = {
      get(k, d){ try { return JSON.parse(localStorage.getItem(k)) ?? d } catch{ return d }},
      set(k, v){ localStorage.setItem(k, JSON.stringify(v)) }
    };

    // Restore best
    state.best = LS.get('murphy_best_streak', 0);
    $('#statBest').textContent = state.best;

    // Build chips 1..12
    const chipWrap = $('#tableChips');
    for(let n=1;n<=12;n++){
      const btn = document.createElement('button');
      btn.className = 'chip' + (state.tables.has(n) ? ' active' : '');
      btn.textContent = n + '×';
      btn.setAttribute('data-n', String(n));
      btn.setAttribute('aria-pressed', state.tables.has(n));
      btn.addEventListener('click', ()=>{
        if(btn.classList.toggle('active')){
          state.tables.add(n);
        } else {
          state.tables.delete(n);
        }
        btn.setAttribute('aria-pressed', btn.classList.contains('active'));
        nextProblem();
      });
      chipWrap.appendChild(btn);
    }

    // Select all / clear
    $('#btnAll').addEventListener('click', ()=>{
      $$('.chip', chipWrap).forEach(c=>{ c.classList.add('active'); c.setAttribute('aria-pressed', true)});
      state.tables = new Set(Array.from({length:12},(_,i)=>i+1));
      nextProblem();
    });
    $('#btnClear').addEventListener('click', ()=>{
      $$('.chip', chipWrap).forEach(c=>{ c.classList.remove('active'); c.setAttribute('aria-pressed', false)});
      state.tables.clear();
      nextProblem();
    });

    // Max multiplier slider
    const maxSlider = $('#maxMultiplier'), maxVal = $('#maxVal');
    maxSlider.addEventListener('input', ()=>{
      state.maxMul = Number(maxSlider.value);
      maxVal.textContent = state.maxMul;
      nextProblem();
    });
    maxVal.textContent = state.maxMul;

    // Mode switching
    function setMode(m){
      state.mode = m;
      $('#statMode').textContent = m === 'arcade' ? 'Arcade' : 'Practice';
      if(m==='arcade'){
        startArcade();
      } else {
        stopTimer();
        $('#statTimer').textContent = '∞';
        resetRound();
        nextProblem();
      }
    }
    $('#modePractice').addEventListener('click', ()=> setMode('practice'));
    $('#modeArcade').addEventListener('click', ()=> setMode('arcade'));

    // Hints toggle
    const hints = $('#hintsToggle');
    function renderHints(){
      $('#hintEnter').style.display = hints.checked ? 'inline' : 'none';
    }
    hints.addEventListener('change', renderHints);
    renderHints();

    // Reset stats
    $('#btnResetStats').addEventListener('click', ()=>{
      localStorage.removeItem('murphy_board');
      localStorage.removeItem('murphy_best_streak');
      state.best = 0; $('#statBest').textContent = '0';
      renderBoard();
      beep('err');
    });

    // Problem generation
    function nextProblem(){
      const tables = Array.from(state.tables);
      // Ensure at least one table
      const a = tables.length ? choice(tables) : 1;
      const b = 1 + rand(state.maxMul);
      state.a = a; state.b = b; state.answer = a*b;
      $('#problem').textContent = `${a} × ${b} = ?`;
      $('#answer').value='';
      $('#feedback').textContent = '';
      $('#answer').focus();
    }

    function updateStats(){
      $('#statScore').textContent = String(state.score);
      $('#statStreak').textContent = String(state.streak);
      const acc = state.attempts ? Math.round(100*state.correct/state.attempts) : 100;
      $('#statAcc').textContent = acc + '%';
    }

    function resetRound(){
      state.score = 0; state.correct = 0; state.attempts = 0; state.streak = 0;
      updateStats();
    }

    function stopTimer(){
      if(state.timer){ clearInterval(state.timer); state.timer = null; }
      state.timeLeft = Infinity;
    }

    function startArcade(){
      resetRound();
      state.timeLeft = 60;
      $('#statTimer').textContent = '60s';
      nextProblem();
      stopTimer();
      state.timer = setInterval(()=>{
        state.timeLeft--;
        $('#statTimer').textContent = state.timeLeft + 's';
        if(state.timeLeft<=0){
          stopTimer();
          endArcade();
        }
      }, 1000);
    }

    function endArcade(){
      const acc = state.attempts ? Math.round(100*state.correct/state.attempts) : 0;
      const score = state.score;
      const when = new Date().toLocaleString();
      const board = LS.get('murphy_board', []);
      board.push({score, acc, when});
      board.sort((a,b)=> b.score - a.score).splice(10);
      LS.set('murphy_board', board);
      renderBoard();
      $('#feedback').className = 'feedback ok';
      $('#feedback').textContent = `Time! You scored ${score} with ${acc}% accuracy.`;
      celebrate();
      beep('ok');
    }

    function renderBoard(){
      const board = LS.get('murphy_board', []);
      const tbody = $('#board tbody');
      tbody.innerHTML = '';
      board.forEach((row, i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${i+1}</td><td><strong>${row.score}</strong></td><td>${row.acc}%</td><td class="tiny">${row.when}</td>`;
        tbody.appendChild(tr);
      });
    }
    renderBoard();

    // Answer handling
    function submit(){
      const val = Number($('#answer').value);
      if(!Number.isFinite(val)) return;
      state.attempts++;
      if(val === state.answer){
        state.correct++; state.score++; state.streak++;
        if(state.streak % 5 === 0){ celebrate(); }
        if(state.streak > state.best){ state.best = state.streak; LS.set('murphy_best_streak', state.best); $('#statBest').textContent = state.best; }
        $('#feedback').className = 'feedback ok';
        $('#feedback').textContent = 'Nice!';
        beep('ok');
        nextProblem();
      } else {
        state.streak = 0;
        $('#feedback').className = 'feedback err';
        $('#feedback').textContent = `Not quite. ${state.a}×${state.b} = ${state.answer}.`;
        beep('err');
        nextProblem();
      }
      updateStats();
    }

    $('#btnSubmit').addEventListener('click', submit);
    $('#btnSkip').addEventListener('click', ()=>{
      $('#feedback').className = 'feedback';
      $('#feedback').textContent = 'Skipped.';
      nextProblem();
    });
    $('#answer').addEventListener('keydown', (e)=>{
      if(e.key === 'Enter'){ submit() }
    });

    // Kick off
    nextProblem();
  </script>
</body>
</html>
